<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>ShaderShop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        html,body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Quicksand', sans-serif;
        }
        #editor { 
        position: absolute;
        top: 5rem;
        right: 1.5rem;
        bottom: 1.5rem;
        left: 40%;
    }
    </style>
    
</head>
<body>
    <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <a class="navbar-item is-spaced" href="index.html">
            <img src="ShaderShopLogoV2_white.png" width="112" height="58" class="">
          </a>
      
          <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>
      
        <div id="navbarBasicExample" class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item">
              Browse
            </a>
      
            <a class="navbar-item">
              Docs
            </a>
      
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">
                More Tools
              </a>
      
              <div class="navbar-dropdown">
                <a class="navbar-item">
                  Shader Exporter
                </a>
                <a class="navbar-item">
                  Shader Converter
                </a>
                <a class="navbar-item">
                  ShaderShop to Unity
                </a>
                <hr class="navbar-divider">
                <a class="navbar-item">
                  Report an issue
                </a>
              </div>
            </div>
          </div>
      
          <div class="navbar-end">
            <div class="navbar-item">
              <div class="buttons">
                <a class="button is-primary">
                  <strong>New</strong>
                </a>
                <a class="button is-light">
                  Log in
                </a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    
      <div class="section">
        <div class="tile is-5" id="shaderViewer">
            <div class="tile is-child">
                <canvas id="shader"></canvas>
            </div>
           
        </div>
        <div class="tile is-7">
            <div id="editor" class="tile is-child">function foo(items) {
    var x = "All this is syntax highlighted";
    return x;
}
            </div>
        </div>
       
      </div>
    
    <div class="section">
        <p id="fps" style="position: fixed; top: 10rem;color:white;">FPS:</p>
    </div>
    <script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");

fetch("shader.glsl")
    .then((res) => res.text())
    .then((fragCode) => {

        const canvas = document.querySelector("#shader");
        var width = 500;
        var height = 500;
        canvas.width = width;
        canvas.height = height;
        const gl = canvas.getContext("webgl");

        const verts = [
            -1,  1,
            1,  1,
            1, -1,
            -1, -1,
        ];

        const indices = [0, 1, 3, 1, 2, 3];
        const vbuf = gl.createBuffer();

        gl.bindBuffer(gl.ARRAY_BUFFER, vbuf);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);

        const ibuf = gl.createBuffer();

        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

        const vertCode =
        'attribute vec2 v_pos;' +
        'varying vec2 a_pos;' +
            
        'void main(void) {' +
            'a_pos = v_pos;' +
            'gl_Position = vec4(v_pos, 0.0, 1.0);' +
        '}';

        const vertShader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vertShader, vertCode);
        gl.compileShader(vertShader);

        const fragShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fragShader, fragCode); 
        gl.compileShader(fragShader);

        const msg = gl.getShaderInfoLog(fragShader);

        if (msg) console.error(msg);

        const prog = gl.createProgram();

        gl.attachShader(prog, vertShader);
        gl.attachShader(prog, fragShader);
        gl.linkProgram(prog);
        gl.useProgram(prog);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbuf);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf);
        const coord = gl.getAttribLocation(prog, "v_pos");
        gl.vertexAttribPointer(coord, 2, gl.FLOAT, false, 0, 0); 
        gl.enableVertexAttribArray(coord);

        gl.clearColor(0, 0, 0, 1);
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.enable(gl.DEPTH_TEST);

        const timeLoc = gl.getUniformLocation(prog, "u_time");
        const mouseLoc = gl.getUniformLocation(prog, "u_mouse");
        let mouseX = 0;
        let mouseY = 0;

        canvas.addEventListener("mousemove", (e) => {
            mouseX = e.clientX / canvas.width;
            mouseY = 1.0 - e.clientY / canvas.height;
        })

        const frame = (t) => {
            gl.uniform1f(timeLoc, t / 1000);
            gl.uniform2f(mouseLoc, mouseX, mouseY);
            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_SHORT, 0);
            requestAnimationFrame(frame);
        };

        frame();

    })
    .catch(console.error);

    </script>
</body>
</html>